<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduVise - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØºÙŠØ±Ø§Øª Ø«ÙŠÙ… ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… (var(--tg-theme-...)) 
        ÙŠØ¶Ù…Ù† Ø£Ù† ØªØªÙƒÙŠÙ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù…Ø¹ ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠÙ„/Ø§Ù„Ù†Ù‡Ø§Ø± ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù… 
        */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #f0f0f0);
            color: var(--tg-theme-text-color, #000000);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .chat-container {
            flex-grow: 1;
            padding: 10px;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse; /* Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ù† Ø§Ù„Ø£Ø³ÙÙ„ */
            min-height: 200px; /* Ù„Ø¶Ù…Ø§Ù† Ø¸Ù‡ÙˆØ± Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        }
        .message-box {
            background-color: var(--tg-theme-secondary-bg-color, #ffffff);
            border-radius: 12px;
            padding: 10px;
            margin-bottom: 8px;
            max-width: 75%;
            align-self: flex-start;
            word-wrap: break-word;
            font-size: 14px;
        }
        .bot-message {
             /* Ù„ÙˆÙ† Ù…Ù…ÙŠØ² Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ùˆ Ø§Ù„Ø¨ÙˆØª */
             background-color: var(--tg-theme-link-color, #a8c1f0); 
             align-self: flex-end;
             text-align: right;
        }
        .input-area {
            display: flex;
            padding: 10px;
            background-color: var(--tg-theme-header-bg-color, #ffffff);
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
        }
        #message-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid var(--tg-theme-secondary-bg-color);
            border-radius: 20px;
            margin-inline-end: 10px;
            background-color: var(--tg-theme-secondary-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            font-size: 16px;
            outline: none;
        }
        #send-button {
            background-color: var(--tg-theme-button-color, #007bff);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
    </style>
</head>
<body>

    <div class="chat-container" id="chat-container">
        <div class="message-box bot-message">
            Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ EduVise ğŸŒŸ. Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§ ÙˆØ³Ø£Ø±Ø³Ù„Ù‡ Ù„Ù„Ø¨ÙˆØª Ù„ØªØ­Ù„ÙŠÙ„Ù‡. ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ø§Ù‹ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª.
        </div>
    </div>

    <div class="input-area">
        <input type="text" id="message-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§...">
        <button id="send-button" title="Ø¥Ø±Ø³Ø§Ù„">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 15 2 11 22 2"></polygon></svg>
        </button>
    </div>

    <script>
        const WebApp = window.Telegram.WebApp;
        
        // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        function addMessage(text, isBot) {
            const container = document.getElementById('chat-container');
            const msgBox = document.createElement('div');
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Øµ Ù…Ø¹ ØªÙ†Ø³ÙŠÙ‚ Ø¨Ø³ÙŠØ·
            msgBox.innerHTML = text.replace(/\n/g, '<br>');

            msgBox.className = 'message-box';
            if (isBot) {
                msgBox.classList.add('bot-message');
                msgBox.alignSelf = 'flex-end'; // Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…/Ø§Ù„Ø¨ÙˆØª
            } else {
                 msgBox.style.backgroundColor = WebApp.themeParams.button_color || '#007bff';
                 msgBox.style.color = WebApp.themeParams.button_text_color || '#ffffff';
                 msgBox.style.alignSelf = 'flex-start'; // Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù„Ù‰ (Ø¨Ø³Ø¨Ø¨ column-reverse)
            container.prepend(msgBox); 
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª
        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            if (text === '') return;

            // 1. Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            addMessage(text, false);
            
            // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª
            try {
                 // Ù†Ø±Ø³Ù„ Ø§Ù„Ù†Øµ ÙƒÙ€ JSON ÙŠØªØ¶Ù…Ù† Ù…ØµØ¯Ø± Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                 const dataToSend = JSON.stringify({
                    text: text,
                    source: 'webapp' 
                 });
                 
                 // ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª ÙƒØ±Ø³Ø§Ù„Ø© Ø®Ø§ØµØ©
                 WebApp.sendData(dataToSend);
                 
                 // Ø¥ÙØ±Ø§Øº Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
                 input.value = '';

                 // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ØµØºØ±Ø© Ù„ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø±Ø¤ÙŠØ© Ø§Ù„Ø±Ø¯ ÙÙŠ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                 setTimeout(() => {
                    WebApp.close();
                 }, 500); 

            } catch(e) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…:', e);
                addMessage('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¹Ø¨Ø± Mini App.', true);
            }
        }
        
        // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            if (WebApp.ready) {
                WebApp.ready();
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©
                document.body.style.backgroundColor = WebApp.themeParams.bg_color;
                
                // Ø¥Ø¹Ø¯Ø§Ø¯ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                document.getElementById('send-button').addEventListener('click', sendMessage);
                document.getElementById('message-input').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
                
            } else {
                // ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¯Ø§Ø®Ù„ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…
                document.body.innerHTML = '<div style="padding: 20px; text-align: center;">ÙŠØ±Ø¬Ù‰ ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ØµØºØ± Ø¯Ø§Ø®Ù„ ØªØ·Ø¨ÙŠÙ‚ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….</div>';
            }
        });
        
    </script>

</body>
  </html>
